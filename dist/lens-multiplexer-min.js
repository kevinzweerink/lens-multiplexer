var Lens=function(e,t){this.poles=[],this.name=e,t&&t.length>0&&(this.poles=t.map(function(e){return e}))};Lens.prototype.addPole=function(e){this.poles.push(e)},Lens.prototype.removePole=function(e){var t=this.poles.indexOf(e);this.poles.splice(t,1)};var Material=function(e,t){this.name=e,this.lenses=t};Material.prototype.getLens=function(e){return this.lenses.reduce(function(t,n){return n.name===e?n:t},void 0)},Material.prototype.addLens=function(e){this.lenses.push(e)},Material.prototype.getPole=function(e,t){return"string"==typeof e&&(e=this.getLens(e)),e.poles.reduce(function(e,n){return n.name===t?n:e},void 0)},Material.prototype.setValueForPole=function(e,t,n){var o=this.getLens(t),a=this.getPole(o,n);a&&(a.value=e)},Material.prototype.extendWithSchema=function(e){for(var t=this,n=0;n<e.length;++n){var o=e[n],a=this.getLens(o.name);a?a.poles=o.poles.map(function(e){var n=t.getPole(a,e.name);return n&&(e.value=n.value),e}):this.addLens(o)}};var Model=function(){this.lenses=[],this.material=[]};Model.prototype.getLens=function(e){return this.lenses.reduce(function(t,n,o){return n.name===e?n:t},void 0)},Model.prototype.getMaterial=function(e){return this.material.reduce(function(t,n){return(n.name=e)?n:t},void 0)},Model.prototype.addLens=function(e,t){var n=new Lens(e,t,this);this.lenses.push(n),this.propagateSchema()},Model.prototype.addPoleToLens=function(e,t){if("string"==typeof e){var n=this.getLens(e);n&&(n.addPole(t),this.propagateSchema())}else console.log("Could not add pole, please provide pole as string")},Model.prototype.addMaterial=function(e){var t=new Material(e,this.generateEmptyLensSchema());this.material.push(t)},Model.prototype.setPoleValue=function(e,t,n,o){var a=this.getMaterial(o);if(!a)return!1;var r=a.getPole(n,t);return r?void(r.value=e):!1},Model.prototype.generateEmptyLensSchema=function(){var e=this.lenses.map(function(e){return{name:e.name,poles:e.poles.map(function(e,t){return{name:e,index:t,value:0}})}});return e},Model.prototype.propagateSchema=function(){for(var e=0;e<this.material.length;++e){var t=this.material[e],n=this.generateEmptyLensSchema();t.extendWithSchema(n)}};var m=new Model;m.addLens("me/nyt",["me","nyt"]),m.addMaterial("Top News"),m.addPoleToLens("me/nyt","cool"),m.setPoleValue(1,"cool","me/nyt","Top News"),m.addMaterial("Recommended"),m.addLens("user/customer/reader",["user","customer","reader"]),console.log(m);